<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Thank you!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>body{font-family:system-ui;margin:2rem;max-width:720px}</style>
</head>
<body>
  <h1>Thank you!</h1>
  <p>Your payment was successful. A receipt will be emailed shortly.</p>
  <div id="summary">Loading orderâ€¦</div>

  <script>
    const qs = new URLSearchParams(location.search);
    const sid = qs.get('session_id');
    async function load() {
      if (!sid) { document.getElementById('summary').textContent = 'Missing session id.'; return; }
      const res = await fetch('/.netlify/functions/get-session?sid=' + encodeURIComponent(sid));
      const data = await res.json();

      // Render a tiny summary
      const meta = data.metadata || {};
      const email = data.customer_email || meta.parent_email || '(no email)';
      const amount = (data.amount_total/100).toFixed(2);

      document.getElementById('summary').innerHTML = `
        <h2>Order Summary</h2>
        <p><strong>Total:</strong> $${amount}</p>
        <p><strong>Email:</strong> ${email}</p>
        <p><strong>Student:</strong> ${meta.student_first || ''} ${meta.student_last || ''}</p>
        <p><strong>Teacher/Grade:</strong> ${meta.teacher || ''} / ${meta.grade || ''}</p>
        <p><strong>School:</strong> ${meta.school || ''}</p>
        <p><strong>Background:</strong> ${meta.background || ''}</p>
        <p><strong>Add-ons:</strong> ${meta.addons || ''}</p>
      `;
    }
    load();
  </script>
</body>
</html>
