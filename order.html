<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Order • Scott Ymker Photography</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <style>
    :root{ --bg:#f7f7f8; --card:#fff; --ink:#111; --muted:#666; --border:#e8e8ea; --accent:#0ea5e9; --ok:#16a34a; }
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--border)}
    .nav{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:18px;padding:10px 16px}
    .nav img{height:28px}
    .nav-spacer{flex:1}
    .nav a{color:#111;text-decoration:none;padding:6px 10px;border-radius:8px}
    .nav a[aria-current="page"]{font-weight:700}
    .wrap{max-width:1100px;margin:22px auto;padding:0 16px}
    .hero{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px 16px;margin-bottom:16px;display:flex;justify-content:space-between;align-items:center}
    .hero h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:1.3fr .7fr;gap:16px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
    .section-title{font-size:15px;font-weight:700;margin:6px 0 10px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .row-4{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:12px;color:var(--muted)}
    .field input,.field select, .field .pill{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#fff}
    .pill{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .addons label{font-size:13px;display:flex;align-items:center;gap:8px}
    .student-card{border:1px dashed var(--border);border-radius:14px;padding:12px;margin-top:12px}
    .student-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .student-head h3{margin:0;font-size:14px}
    .student-head button{appearance:none;border:1px solid var(--border);background:#fff;padding:6px 10px;border-radius:10px;cursor:pointer}
    .small{font-size:12px;color:var(--muted)}
    .addbtn{appearance:none;border:1px dashed var(--border);background:#fff;padding:10px 12px;border-radius:12px;cursor:pointer}
    .primary{background:var(--accent);border-color:var(--accent);color:#fff}
    .right-sticky{position:sticky;top:76px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--border);padding:8px 4px;text-align:left;font-size:14px}
    th{font-size:12px;color:var(--muted)}
    tfoot td{font-weight:700}
    .actions{display:flex;gap:10px;margin-top:12px}
    .cta{appearance:none;border:1px solid var(--border);background:#fff;padding:10px 14px;border-radius:999px;cursor:pointer}
    .cta.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  </style>
</head>
<body>
  <header>
    <nav class="nav">
      <img src="2020Logo_black.png" alt="Scott Ymker Photography">
      <div class="nav-spacer"></div>
      <a href="index.html">Home</a>
      <a href="order.html" aria-current="page">Order</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <div class="wrap">
    <section class="hero">
      <h1>Order your school photo package</h1>
      <div class="small">One checkout for up to 6 students</div>
    </section>

    <div class="grid" id="grid">
      <!-- LEFT: form -->
      <div class="card">
        <form id="orderForm">
          <!-- Parent/School -->
          <div class="section-title">Parent & school</div>
          <div class="row">
            <div class="field"><label>Parent name</label><input name="parent_name" placeholder="Jane Doe" required></div>
            <div class="field"><label>Phone</label><input name="parent_phone" placeholder="555-123-4567" required></div>
          </div>
          <div class="row">
            <div class="field"><label>Email (prefilled on Stripe)</label><input type="email" name="parent_email" placeholder="jane@example.com" required></div>
            <div class="field"><label>School</label><input name="school" placeholder="NRCS" required></div>
          </div>

          <!-- Students container -->
          <div id="students"></div>
          <div class="small" id="studentLimitNote" style="margin-top:6px;"></div>

          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <button class="addbtn" id="addStudentBtn" type="button">+ Add another student</button>
          </div>

          <div class="actions">
            <button type="submit" class="cta primary" id="checkoutBtn">Proceed to Checkout</button>
          </div>
        </form>
      </div>

      <!-- RIGHT: summary -->
      <aside class="card right-sticky">
        <h3 style="margin:0 0 10px 0">Order summary</h3>
        <table>
          <thead><tr><th>Description</th><th>Qty</th><th>Amount</th></tr></thead>
          <tbody id="summaryBody"></tbody>
          <tfoot>
            <tr><td colspan="2">Total</td><td id="summaryTotal">$0.00</td></tr>
          </tfoot>
        </table>
      </aside>
    </div>
  </div>

  <script>
    // ---------- pricing ----------
    const PKG = { A:3200,A1:4100,B:2700,B1:3200,C:2200,C1:2700,D:1800,D1:2300,E:1200,E1:1700 };
    const ADD = {
      F:{name:"8x10 Print",amt:600}, G:{name:"2x 5x7 Prints",amt:600}, H:{name:"4x 3½x5 Prints",amt:600},
      I:{name:"24 Wallets",amt:1800}, J:{name:"8 Wallets",amt:600}, K:{name:"16 Mini Wallets",amt:600},
      L:{name:"Retouching",amt:700},  M:{name:"8x10 Class Composite",amt:800}, N:{name:"Digital File",amt:1500}
    };
    const MAX_STUDENTS = 6;

    // ---------- helpers ----------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const money = c => (c/100).toLocaleString(undefined,{style:'currency',currency:'USD'});

    // ---------- dynamic students ----------
    const studentsEl = $('#students');
    const addBtn = $('#addStudentBtn');
    const limitNote = $('#studentLimitNote');

    function studentTemplate(i){
      return `
      <div class="student-card" data-idx="${i}">
        <div class="student-head">
          <h3>Student ${i+1}</h3>
          <button type="button" class="remove" aria-label="Remove student">Remove</button>
        </div>

        <div class="row">
          <div class="field">
            <label>Package</label>
            <select name="package" required>
              <option value="">— Select a Package —</option>
              <option value="A">Package A — $32</option>
              <option value="A1">Package A1 — $41</option>
              <option value="B">Package B — $27</option>
              <option value="B1">Package B1 — $32</option>
              <option value="C">Package C — $22</option>
              <option value="C1">Package C1 — $27</option>
              <option value="D">Package D — $18</option>
              <option value="D1">Package D1 — $23</option>
              <option value="E">Package E — $12</option>
              <option value="E1">Package E1 — $17</option>
            </select>
          </div>
          <div class="field">
            <label>Background</label>
            <select name="background" required>
              <option value="F1" selected>F1 (Default)</option>
              <option value="F2">F2</option>
              <option value="F3">F3</option>
              <option value="F4">F4</option>
              <option value="F5">F5</option>
              <option value="F6">F6</option>
            </select>
          </div>
        </div>

        <div class="field addons">
          <label>Add-Ons</label>
          <div class="row-4">
            ${Object.entries(ADD).map(([code,a]) => `
              <label><input type="checkbox" name="addons" value="${code}"> ${code} — ${a.name} (${money(a.amt)})</label>
            `).join('')}
          </div>
        </div>

        <div class="row">
          <div class="field"><label>First name</label><input name="student_first" required></div>
          <div class="field"><label>Last name</label><input name="student_last" required></div>
        </div>
        <div class="row">
          <div class="field"><label>Teacher</label><input name="teacher" required></div>
          <div class="field"><label>Grade</label><input name="grade" required></div>
        </div>
      </div>
      `;
    }

    function addStudent(){
      const count = studentsEl.children.length;
      if(count >= MAX_STUDENTS){ limitNote.textContent = "Maximum of 6 students per order."; return; }
      studentsEl.insertAdjacentHTML('beforeend', studentTemplate(count));
      wireStudent(studentsEl.lastElementChild);
      updateSummary();
      limitNote.textContent = count+1 >= MAX_STUDENTS ? "Maximum of 6 students per order." : "";
    }

    function wireStudent(card){
      card.querySelector('.remove').addEventListener('click', () => {
        card.remove(); renumber(); updateSummary(); limitNote.textContent="";
      });
      card.addEventListener('change', updateSummary);
      card.addEventListener('input', updateSummary);
    }

    function renumber(){
      [...studentsEl.children].forEach((el,i)=> {
        el.dataset.idx=i;
        el.querySelector('h3').textContent = `Student ${i+1}`;
      });
    }

    addBtn.addEventListener('click', addStudent);

    // start with 1 student
    addStudent();

    // ---------- summary ----------
    function collect(){
      const parent = {
        parent_name: $('input[name="parent_name"]').value.trim(),
        parent_phone: $('input[name="parent_phone"]').value.trim(),
        parent_email: $('input[name="parent_email"]').value.trim(),
        school:       $('input[name="school"]').value.trim()
      };
      const students = [...studentsEl.children].map(card => {
        const sel = q => card.querySelector(q);
        const getAddons = () => [...card.querySelectorAll('input[name="addons"]:checked')].map(cb=>cb.value);
        return {
          package: sel('select[name="package"]').value,
          background: sel('select[name="background"]').value,
          addons: getAddons(),
          student_first: sel('input[name="student_first"]').value.trim(),
          student_last:  sel('input[name="student_last"]').value.trim(),
          teacher:       sel('input[name="teacher"]').value.trim(),
          grade:         sel('input[name="grade"]').value.trim(),
          school: parent.school
        };
      });
      return { parent, students };
    }

    function updateSummary(){
      const {students} = collect();
      const body = $('#summaryBody'); body.innerHTML='';
      let total = 0;
      students.forEach(s=>{
        if(s.package && PKG[s.package]){
          total += PKG[s.package];
          const tr=document.createElement('tr');
          tr.innerHTML = `<td>Package ${s.package} — ${s.student_first} ${s.student_last}</td><td>1</td><td>${money(PKG[s.package])}</td>`;
          body.appendChild(tr);
        }
        (s.addons||[]).forEach(code=>{
          if(ADD[code]){
            total += ADD[code].amt;
            const tr=document.createElement('tr');
            tr.innerHTML = `<td>Add-on ${code} — ${ADD[code].name} — ${s.student_first} ${s.student_last}</td><td>1</td><td>${money(ADD[code].amt)}</td>`;
            body.appendChild(tr);
          }
        });
      });
      $('#summaryTotal').textContent = money(total);
    }

    // Keep summary live
    $('#orderForm').addEventListener('input', updateSummary);
    $('#orderForm').addEventListener('change', updateSummary);

    // ---------- submit ----------
    $('#orderForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const payload = collect();
      if(!payload.students.length || !payload.students.every(s=>s.package)){
        alert('Please choose a package for each student.'); return;
      }
      const btn = $('#checkoutBtn'); const txt = btn.textContent; btn.disabled = true; btn.textContent = 'Processing…';
      try{
        const res = await fetch('/.netlify/functions/create-checkout-session',{
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        const json = await res.json();
        if(!res.ok || !json.url){ console.error(json); alert(json.error || 'Stripe error'); btn.disabled=false; btn.textContent=txt; return; }
        location.href = json.url;
      }catch(err){ console.error(err); alert('Network error. Try again.'); btn.disabled=false; btn.textContent=txt; }
    });
  </script>
</body>
</html>
