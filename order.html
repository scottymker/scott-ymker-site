<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Order â€¢ Scott Ymker Photography</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#fafafa; --card:#fff; --ink:#111; --muted:#666; --accent:#0ea5e9;
      --ok:#16a34a; --border:#e7e7e9;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:1000px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;gap:14px;margin-bottom:16px}
    header img{height:42px;width:auto}
    header .brand{font-weight:700;letter-spacing:.2px}

    .hero{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:22px 20px;display:flex;align-items:center;gap:12px}
    .hero .flag{height:32px;width:32px;border-radius:50%;display:grid;place-items:center;background:rgba(14,165,233,.12);color:var(--accent);font-weight:700}
    h1{margin:0;font-size:22px}
    .subtle{color:var(--muted);margin-top:4px}

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:18px;margin-top:18px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px}
    .card h2{font-size:16px;margin:0 0 12px}

    /* Form */
    form .section{margin-bottom:14px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:680px){.row{grid-template-columns:1fr}}
    label.title{display:block;font-size:14px;font-weight:600;margin-bottom:8px}
    .field{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}
    .field label{font-size:13px;color:var(--muted)}
    select,input[type="text"],input[type="email"],input[type="tel"]{
      width:100%;padding:11px 12px;border:1px solid var(--border);border-radius:10px;font:inherit;background:#fff
    }
    .addons label{display:flex;align-items:center;gap:10px;padding:8px 10px;border:1px solid var(--border);border-radius:10px;margin-bottom:8px;cursor:pointer}
    .addons small{color:var(--muted)}
    .btn{appearance:none;border:1px solid var(--border);background:#fff;padding:12px 16px;border-radius:999px;cursor:pointer;font-weight:600}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
    .btn[disabled]{opacity:.6;cursor:not-allowed}

    /* Summary */
    .kv{display:grid;grid-template-columns:140px 1fr;row-gap:8px;column-gap:12px}
    .kv .k{color:var(--muted)}
    table.items{width:100%;border-collapse:collapse}
    .items th,.items td{padding:8px;border-bottom:1px solid var(--border);text-align:left}
    .items th{font-size:13px;color:var(--muted)}
    .totalRow td{font-weight:700}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="2020Logo_black.png" alt="Scott Ymker Photography">
      <div class="brand">Scott Ymker Photography</div>
    </header>

    <section class="hero">
      <div class="flag">ðŸ“¸</div>
      <div>
        <h1>Order your school photo package</h1>
        <div class="subtle">Choose a package, add-ons, and enter student & parent details.</div>
      </div>
    </section>

    <section class="grid">
      <!-- LEFT: FORM -->
      <div class="card">
        <form id="orderForm" novalidate>
          <!-- Package -->
          <div class="section">
            <label class="title" for="package">Select a Package</label>
            <select name="package" id="package" required>
              <option value="">â€” Select a Package â€”</option>
              <option value="A">Package A â€” $32 (1 8x10 Class Composite, 2 8x10, 2 5x7, 8 wallets, 16 mini wallets)</option>
              <option value="A1">Package A1 â€” $41 (A + 1 Digital File)</option>
              <option value="B">Package B â€” $27 (1 8x10 Class Composite, 1 8x10, 2 5x7, 16 wallets)</option>
              <option value="B1">Package B1 â€” $32 (B + 2 extra 5x7)</option>
              <option value="C">Package C â€” $22 (1 8x10 Class Composite, 1 8x10, 2 3.5x5, 4 wallets, 16 mini wallets)</option>
              <option value="C1">Package C1 â€” $27 (C + 2 5x7)</option>
              <option value="D">Package D â€” $18 (1 8x10 Class Composite, 2 5x7, 8 wallets)</option>
              <option value="D1">Package D1 â€” $23 (D + 16 mini wallets)</option>
              <option value="E">Package E â€” $12 (2 5x7, 2 3.5x5, 4 wallets)</option>
              <option value="E1">Package E1 â€” $17 (E + 8 extra wallets)</option>
            </select>
          </div>

          <!-- Add-ons -->
          <div class="section">
            <label class="title">Select Add-Ons</label>
            <div class="addons" id="addonsBox">
              <label><input type="checkbox" name="addons" value="F" /> F â€” 8x10 Print <small>($6)</small></label>
              <label><input type="checkbox" name="addons" value="G" /> G â€” 2Ã— 5x7 Prints <small>($6)</small></label>
              <label><input type="checkbox" name="addons" value="H" /> H â€” 4Ã— 3Â½x5 Prints <small>($6)</small></label>
              <label><input type="checkbox" name="addons" value="I" /> I â€” 24 Wallets <small>($18)</small></label>
              <label><input type="checkbox" name="addons" value="J" /> J â€” 8 Wallets <small>($6)</small></label>
              <label><input type="checkbox" name="addons" value="K" /> K â€” 16 Mini Wallets <small>($6)</small></label>
              <label><input type="checkbox" name="addons" value="L" /> L â€” Retouching <small>($7)</small></label>
              <label><input type="checkbox" name="addons" value="M" /> M â€” 8x10 Class Composite <small>($8)</small></label>
              <label><input type="checkbox" name="addons" value="N" /> N â€” Digital File <small>($15)</small></label>
            </div>
          </div>

          <!-- Background -->
          <div class="section">
            <label class="title" for="background">Select a Background</label>
            <select name="background" id="background" required>
              <option value="F1" selected>F1 (Default)</option>
              <option value="F2">F2</option>
              <option value="F3">F3</option>
              <option value="F4">F4</option>
              <option value="F5">F5</option>
              <option value="F6">F6</option>
            </select>
          </div>

          <!-- Student -->
          <div class="section">
            <label class="title">Student Information</label>
            <div class="row">
              <div class="field"><label>First name</label><input type="text" name="student_first" required></div>
              <div class="field"><label>Last name</label><input type="text" name="student_last" required></div>
            </div>
            <div class="row">
              <div class="field"><label>Teacher</label><input type="text" name="teacher" required></div>
              <div class="field"><label>Grade</label><input type="text" name="grade" required></div>
            </div>
            <div class="field"><label>School</label><input type="text" name="school" required></div>
          </div>

          <!-- Parent -->
          <div class="section">
            <label class="title">Parent / Guardian</label>
            <div class="field"><label>Name</label><input type="text" name="parent_name" required></div>
            <div class="row">
              <div class="field"><label>Phone</label><input type="tel" name="parent_phone" required></div>
              <div class="field"><label>Email</label><input type="email" name="parent_email" required></div>
            </div>
          </div>

          <div class="section">
            <button type="submit" id="checkout-button" class="btn primary">Proceed to Checkout</button>
            <span class="muted" style="margin-left:10px">Youâ€™ll review & pay securely on Stripe.</span>
          </div>
        </form>
      </div>

      <!-- RIGHT: SUMMARY -->
      <div class="card" id="summaryCard" aria-live="polite">
        <h2>Order summary</h2>
        <table class="items" id="itemsTable">
          <thead><tr><th>Description</th><th>Qty</th><th>Amount</th></tr></thead>
          <tbody id="itemsBody"><tr><td class="muted" colspan="3">Select a package to see your total.</td></tr></tbody>
          <tfoot>
            <tr class="totalRow"><td colspan="2">Total</td><td id="totalCell">$0.00</td></tr>
          </tfoot>
        </table>

        <div style="margin-top:14px">
          <div class="kv">
            <div class="k">Background</div><div id="kvBg">F1</div>
            <div class="k">Student</div><div id="kvStudent">â€”</div>
            <div class="k">Teacher / Grade</div><div id="kvTG">â€”</div>
            <div class="k">School</div><div id="kvSchool">â€”</div>
            <div class="k">Parent</div><div id="kvParent">â€”</div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // ---------- price tables (cents) ----------
    const PACKAGE_PRICES = {
      A: 3200, A1: 4100,
      B: 2700, B1: 3200,
      C: 2200, C1: 2700,
      D: 1800, D1: 2300,
      E: 1200, E1: 1700
    };

    const ADDON_PRICES = {
      F: 600,  G: 600,  H: 600,
      I: 1800, J: 600,  K: 600,
      L: 700,  M: 800,  N: 1500
    };

    const ADDON_NAMES = {
      F: "8x10 Print",
      G: "2Ã— 5x7 Prints",
      H: "4Ã— 3Â½x5 Prints",
      I: "24 Wallets",
      J: "8 Wallets",
      K: "16 Mini Wallets",
      L: "Retouching",
      M: "8x10 Class Composite",
      N: "Digital File"
    };

    // ---------- helpers ----------
    const $ = (sel) => document.querySelector(sel);
    const getVal = (sel) => { const el = $(sel); return el ? el.value.trim() : ""; };
    const getAddons = () => Array.from(document.querySelectorAll('input[name="addons"]:checked')).map(cb => cb.value);
    const money = (cents) => (cents/100).toLocaleString(undefined,{style:'currency',currency:'USD'});

    function buildLineItems(pkg, addons){
      const list = [];
      if (PACKAGE_PRICES[pkg]){
        list.push({
          price_data:{ currency:"usd", product_data:{ name:`Package ${pkg}` }, unit_amount:PACKAGE_PRICES[pkg] },
          quantity:1
        });
      }
      addons.forEach(code=>{
        const amt = ADDON_PRICES[code];
        if (amt){
          list.push({
            price_data:{ currency:"usd", product_data:{ name:`Add-on ${code} â€” ${ADDON_NAMES[code]||""}` }, unit_amount:amt },
            quantity:1
          });
        }
      });
      return list;
    }

    function updateSummary(){
      const pkg = getVal('#package');
      const addons = getAddons();
      const tbody = $('#itemsBody');
      tbody.innerHTML = '';

      let total = 0;

      if (pkg && PACKAGE_PRICES[pkg]){
        total += PACKAGE_PRICES[pkg];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>Package ${pkg}</td><td>1</td><td>${money(PACKAGE_PRICES[pkg])}</td>`;
        tbody.appendChild(tr);
      }

      addons.forEach(code=>{
        const amt = ADDON_PRICES[code];
        if (amt){
          total += amt;
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>Add-on ${code} â€” ${ADDON_NAMES[code]||''}</td><td>1</td><td>${money(amt)}</td>`;
          tbody.appendChild(tr);
        }
      });

      if (!tbody.children.length){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="muted" colspan="3">Select a package to see your total.</td>`;
        tbody.appendChild(tr);
      }

      $('#totalCell').textContent = money(total);

      // details preview
      $('#kvBg').textContent = getVal('#background') || 'F1';
      const student = [getVal('input[name="student_first"]'), getVal('input[name="student_last"]')].filter(Boolean).join(' ');
      $('#kvStudent').textContent = student || 'â€”';
      const tg = [getVal('input[name="teacher"]'), getVal('input[name="grade"]')].filter(Boolean).join(' / ');
      $('#kvTG').textContent = tg || 'â€”';
      $('#kvSchool').textContent = getVal('input[name="school"]') || 'â€”';
      $('#kvParent').textContent = getVal('input[name="parent_name"]') || 'â€”';
    }

    // attach listeners for live summary updates
    ['change','input'].forEach(ev=>{
      document.addEventListener(ev, (e)=>{
        if (e.target.matches('#package, #background, input[name="addons"], input[name="student_first"], input[name="student_last"], input[name="teacher"], input[name="grade"], input[name="school"], input[name="parent_name"]')){
          updateSummary();
        }
      });
    });
    updateSummary();

    // ---------- submit handler ----------
    $('#orderForm')?.addEventListener('submit', async (e) => {
      e.preventDefault();

      const pkg = getVal('#package');
      if (!pkg) { alert('Please select a package.'); return; }

      const addons = getAddons();
      const line_items = buildLineItems(pkg, addons);

      const metadata = {
        background:    getVal('#background'),
        student_first: getVal('input[name="student_first"]'),
        student_last:  getVal('input[name="student_last"]'),
        teacher:       getVal('input[name="teacher"]'),
        grade:         getVal('input[name="grade"]'),
        school:        getVal('input[name="school"]'),
        parent_name:   getVal('input[name="parent_name"]'),
        parent_phone:  getVal('input[name="parent_phone"]'),
        parent_email:  getVal('input[name="parent_email"]'),
        addons:        addons.join(', ')
      };

      const email = metadata.parent_email;

      const btn = $('#checkout-button');
      const originalText = btn.textContent;
      btn.disabled = true;
      btn.textContent = 'Processingâ€¦';

      try {
        const res = await fetch('/.netlify/functions/create-checkout-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ line_items, metadata, email })
        });
        const json = await res.json();

        if (!res.ok) {
          console.error('Stripe error:', json);
          const msg = json?.details?.error?.message || json?.error || 'Stripe error';
          alert(msg);
          btn.disabled = false;
          btn.textContent = originalText;
          return;
        }

        if (json.url) {
          window.location.href = json.url;
        } else {
          alert('No checkout URL returned.');
          btn.disabled = false;
          btn.textContent = originalText;
        }
      } catch (err) {
        console.error(err);
        alert('Network error. Please try again.');
        btn.disabled = false;
        btn.textContent = originalText;
      }
    });
  </script>
</body>
</html>
