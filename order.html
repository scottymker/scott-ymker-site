<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Order - Scott Ymker Photography</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f7f7f8; --card:#fff; --ink:#111; --muted:#666; --border:#e6e7eb;
      --accent:#0ea5e9; --accent-ink:#fff; --ring:rgba(14,165,233,.25);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    a{color:inherit;text-decoration:none}

    /* Header / nav (from v2) */
    .sitebar{
      position:sticky; top:0; z-index:2;
      background:#f9f9fb; border-bottom:1px solid var(--border);
    }
    .sitebar .inner{
      max-width:1120px; margin:0 auto; padding:12px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:16px;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:700}
    .brand img{height:28px; width:auto}
    .nav a{padding:8px 10px; color:#333}
    .nav a[aria-current="page"]{font-weight:700}

    /* Hero (keep v1 copy) */
    .hero{max-width:1120px; margin:18px auto 8px; padding:0 18px;}
    .hero .card{
      background:var(--card); border:1px solid var(--border); border-radius:14px;
      padding:18px; display:flex; align-items:center; justify-content:space-between; gap:16px;
    }
    .hero h1{margin:0; font-size:20px}
    .hero p{margin:4px 0 0; color:var(--muted); font-size:14px}
    .secure{color:var(--muted); font-size:12px}

    /* Main layout */
    .wrap{max-width:1120px; margin:0 auto; padding:0 18px 28px}
    .grid{display:grid; grid-template-columns:1fr 360px; gap:18px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:16px}
    h2{font-size:14px; margin:0 0 10px}

    /* Inputs */
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:700px){.row{grid-template-columns:1fr}}
    select, input[type="text"], input[type="tel"], input[type="email"]{
      width:100%; padding:10px 12px; font:inherit; color:inherit; background:#fff;
      border:1px solid var(--border); border-radius:10px; outline:none;
    }
    select:focus, input:focus{box-shadow:0 0 0 4px var(--ring); border-color:#b6e6fb}

    .checkgroup{display:grid; gap:8px}
    .checkline{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#fff;
    }
    .checkline small{color:var(--muted)}

    .submitbar{display:flex; align-items:center; gap:12px; margin-top:10px}
    .btn{
      appearance:none; cursor:pointer; border-radius:999px; border:1px solid var(--accent);
      background:var(--accent); color:var(--accent-ink); padding:12px 16px; font-weight:600;
    }
    .note{color:var(--muted); font-size:12px}

    /* Summary (right) */
    .summary h3{margin:0 0 12px; font-size:16px}
    table{width:100%; border-collapse:collapse}
    th,td{border-bottom:1px solid var(--border); padding:8px 4px; text-align:left; font-size:13px}
    th{color:var(--muted); font-weight:600}
    tfoot td{font-weight:700}
    .kv{margin-top:10px}
    .kv .line{display:grid; grid-template-columns:140px 1fr; gap:10px; font-size:13px; padding:6px 0}
    .kv .label{color:var(--muted)}
  </style>
</head>
<body>

  <!-- Header / nav -->
  <div class="sitebar">
    <div class="inner">
      <div class="brand">
        <img src="2020Logo_black.png" alt="Scott Ymker Photography">
        <span>Scott Ymker Photography</span>
      </div>
      <nav class="nav" aria-label="Primary">
        <a href="index.html">Home</a>
        <a href="order.html" aria-current="page">Order</a>
        <a href="mailto:support@scottymkerphotos.com">Contact</a>
      </nav>
    </div>
  </div>

  <!-- Hero -->
  <div class="hero">
    <div class="card">
      <div>
        <h1>Order your school photo package</h1>
        <p>Choose a package, add-ons, and enter student &amp; parent details.</p>
      </div>
      <div class="secure">Secure checkout powered by Stripe</div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <!-- LEFT: FORM (v1 content) -->
      <form id="orderForm" class="card" novalidate>
        <section>
          <h2>Select a Package</h2>
          <select name="package" required>
            <option value="">-- Select a Package --</option>
            <option value="A">Package A – $32 (1 8x10 Class Composite, 2 8x10, 2 5x7, 8 wallets, 16 mini wallets)</option>
            <option value="A1">Package A1 – $41 (A + 1 Digital File)</option>
            <option value="B">Package B – $27 (1 8x10 Class Composite, 1 8x10, 2 5x7, 16 wallets)</option>
            <option value="B1">Package B1 – $32 (B + 2 extra 5x7)</option>
            <option value="C">Package C – $22 (1 8x10 Class Composite, 1 8x10, 2 3.5x5, 4 wallets, 16 mini wallets)</option>
            <option value="C1">Package C1 – $27 (C + 2 5x7)</option>
            <option value="D">Package D – $18 (1 8x10 Class Composite, 2 5x7, 8 wallets)</option>
            <option value="D1">Package D1 – $23 (D + 16 mini wallets)</option>
            <option value="E">Package E – $12 (2 5x7, 2 3.5x5, 4 wallets)</option>
            <option value="E1">Package E1 – $17 (E + 8 extra wallets)</option>
          </select>
        </section>

        <section style="margin-top:10px">
          <h2>Select Add-Ons</h2>
          <div class="checkgroup">
            <label class="checkline"><input type="checkbox" name="addons" value="F"> <span>F — 8x10 Print <small>($6)</small></span></label>
            <label class="checkline"><input type="checkbox" name="addons" value="G"> <span>G — 2× 5x7 Prints <small>($6)</small></span></label>
            <label class="checkline"><input type="checkbox" name="addons" value="H"> <span>H — 4× 3½x5 Prints <small>($6)</small></span></label>
            <label class="checkline"><input type="checkbox" name="addons" value="I"> <span>I — 24 Wallets <small>($18)</small></span></label>
            <label class="checkline"><input type="checkbox" name="addons" value="J"> <span>J — 8 Wallets <small>($6)</small></span></label>
            <label class="checkline"><input type="checkbox" name="addons" value="K"> <span>K — 16 Mini Wallets <small>($6)</small></span></label>
            <label class="checkline"><input type="checkbox" name="addons" value="L"> <span>L — Retouching <small>($7)</small></span></label>
            <label class="checkline"><input type="checkbox" name="addons" value="M"> <span>M — 8x10 Class Composite <small>($8)</small></span></label>
            <label class="checkline"><input type="checkbox" name="addons" value="N"> <span>N — Digital File <small>($15)</small></span></label>
          </div>
        </section>

        <section style="margin-top:10px">
          <h2>Select a Background</h2>
          <select name="background" required>
            <option value="F1" selected>F1 (Default)</option>
            <option value="F2">F2</option>
            <option value="F3">F3</option>
            <option value="F4">F4</option>
            <option value="F5">F5</option>
            <option value="F6">F6</option>
          </select>
        </section>

        <section style="margin-top:10px">
          <h2>Student Information</h2>
          <div class="row">
            <input type="text" name="student_first" placeholder="First name" required>
            <input type="text" name="student_last" placeholder="Last name" required>
          </div>
          <div class="row" style="margin-top:8px">
            <input type="text" name="teacher" placeholder="Teacher" required>
            <input type="text" name="grade" placeholder="Grade" required>
          </div>
          <input type="text" name="school" placeholder="School" style="margin-top:8px" required>
        </section>

        <section style="margin-top:10px">
          <h2>Parent Information</h2>
          <input type="text" name="parent_name" placeholder="Parent / Guardian" required>
          <div class="row" style="margin-top:8px">
            <input type="tel" name="parent_phone" placeholder="Phone" required>
            <input type="email" name="parent_email" placeholder="Email" required>
          </div>
          <div class="submitbar">
            <button type="submit" id="checkout-button" class="btn">Proceed to Checkout</button>
            <div class="note">You’ll review &amp; pay securely on Stripe.</div>
          </div>
        </section>
      </form>

      <!-- RIGHT: SUMMARY -->
      <aside class="card summary" aria-live="polite">
        <h3>Order summary</h3>
        <table>
          <thead>
            <tr><th>Description</th><th>Qty</th><th>Amount</th></tr>
          </thead>
          <tbody id="sumItems"></tbody>
          <tfoot>
            <tr><td colspan="2">Total</td><td id="sumTotal">$0.00</td></tr>
          </tfoot>
        </table>

        <div class="kv">
          <div class="line"><div class="label">Background</div><div id="kvBg">F1</div></div>
          <div class="line"><div class="label">Student</div><div id="kvStudent">—</div></div>
          <div class="line"><div class="label">Teacher / Grade</div><div id="kvTG">—</div></div>
          <div class="line"><div class="label">School</div><div id="kvSchool">—</div></div>
          <div class="line"><div class="label">Parent</div><div id="kvParent">—</div></div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // ---------- price tables (cents) ----------
    const PACKAGE_PRICES = {
      A:3200, A1:4100, B:2700, B1:3200,
      C:2200, C1:2700, D:1800, D1:2300,
      E:1200, E1:1700
    };
    const ADDON_PRICES = {
      F:600, G:600, H:600, I:1800, J:600, K:600, L:700, M:800, N:1500
    };
    const ADDON_NAMES = {
      F:"8x10 Print", G:"2× 5x7 Prints", H:"4× 3½x5 Prints",
      I:"24 Wallets", J:"8 Wallets", K:"16 Mini Wallets",
      L:"Retouching", M:"8x10 Class Composite", N:"Digital File"
    };

    // ---------- helpers ----------
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));
    const getVal = (sel) => ($(sel)?.value || '').trim();
    const money = (c) => (c/100).toLocaleString(undefined,{style:'currency', currency:'USD'});

    // ---------- live summary ----------
    function rebuildSummary(){
      const pkg = getVal('select[name="package"]');
      const addons = $$('input[name="addons"]:checked').map(cb => cb.value);
      const tbody = $('#sumItems'); tbody.innerHTML = '';
      let total = 0;

      if (pkg && PACKAGE_PRICES[pkg]){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>Package ${pkg}</td><td>1</td><td>${money(PACKAGE_PRICES[pkg])}</td>`;
        tbody.appendChild(tr);
        total += PACKAGE_PRICES[pkg];
      }
      addons.forEach(code=>{
        const amt = ADDON_PRICES[code];
        if (!amt) return;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>Add-on ${code} — ${ADDON_NAMES[code]}</td><td>1</td><td>${money(amt)}</td>`;
        tbody.appendChild(tr);
        total += amt;
      });

      $('#sumTotal').textContent = money(total);

      // Details section
      $('#kvBg').textContent = getVal('select[name="background"]') || '—';
      const student = [getVal('input[name="student_first"]'), getVal('input[name="student_last"]')].filter(Boolean).join(' ');
      $('#kvStudent').textContent = student || '—';
      const tg = [getVal('input[name="teacher"]'), getVal('input[name="grade"]')].filter(Boolean).join(' / ');
      $('#kvTG').textContent = tg || '—';
      $('#kvSchool').textContent = getVal('input[name="school"]') || '—';
      $('#kvParent').textContent = getVal('input[name="parent_name"]') || '—';
    }

    // Bind live updates
    ['change','input'].forEach(evt=>{
      ['select[name="package"]','select[name="background"]',
       'input[name="student_first"]','input[name="student_last"]',
       'input[name="teacher"]','input[name="grade"]','input[name="school"]',
       'input[name="parent_name"]','input[name="parent_phone"]',
       'input[name="parent_email"]'
      ].forEach(sel => $(sel).addEventListener(evt, rebuildSummary));
      $$('input[name="addons"]').forEach(cb => cb.addEventListener(evt, rebuildSummary));
    });
    rebuildSummary();

    // ---------- submit handler ----------
    $('#orderForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const pkg = getVal('select[name="package"]');
      if (!pkg) { alert('Please select a package.'); return; }
      const addons = $$('input[name="addons"]:checked').map(cb => cb.value);

      // Build Stripe line_items
      const line_items = [];
      if (PACKAGE_PRICES[pkg]) {
        line_items.push({
          price_data:{ currency:'usd', product_data:{ name:`Package ${pkg}` }, unit_amount:PACKAGE_PRICES[pkg] },
          quantity:1
        });
      }
      addons.forEach(code=>{
        const amt = ADDON_PRICES[code];
        if (amt) {
          line_items.push({
            price_data:{ currency:'usd', product_data:{ name:`Add-on ${code} — ${ADDON_NAMES[code]||''}` }, unit_amount:amt },
            quantity:1
          });
        }
      });

      // Metadata (strings)
      const metadata = {
        background:    getVal('select[name="background"]'),
        student_first: getVal('input[name="student_first"]'),
        student_last:  getVal('input[name="student_last"]'),
        teacher:       getVal('input[name="teacher"]'),
        grade:         getVal('input[name="grade"]'),
        school:        getVal('input[name="school"]'),
        parent_name:   getVal('input[name="parent_name"]'),
        parent_phone:  getVal('input[name="parent_phone"]'),
        parent_email:  getVal('input[name="parent_email"]'),
        addons:        addons.join(', ')
      };

      // Prefill Stripe Checkout email
      const email = metadata.parent_email;

      const btn = $('#checkout-button');
      const original = btn.textContent;
      btn.disabled = true; btn.textContent = 'Processing…';

      try{
        const res = await fetch('/.netlify/functions/create-checkout-session', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ line_items, metadata, email })
        });
        const json = await res.json();

        if (!res.ok) {
          console.error('Stripe error:', json);
          const msg = json?.details?.error?.message || json?.error || 'Stripe error';
          alert(msg);
          btn.disabled = false; btn.textContent = original;
          return;
        }
        if (json.url) {
          window.location.href = json.url;
        } else {
          alert('No checkout URL returned.');
          btn.disabled = false; btn.textContent = original;
        }
      } catch(err){
        console.error(err);
        alert('Network error. Please try again.');
        btn.disabled = false; btn.textContent = original;
      }
    });
  </script>
</body>
</html>
