<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Order (Accordion) – Scott Ymker Photography</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#f6f7f9; --card:#fff; --ink:#111; --muted:#6b7280; --accent:#0ea5e9; --accent-ink:#fff; --border:#e5e7eb; --nav-h:64px; }
    *{ box-sizing:border-box }
    html,body{ margin:0; background:var(--bg); color:var(--ink); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; overflow-x:hidden }
    img{ max-width:100%; height:auto; display:block }
    a{ color:inherit; text-decoration:none }

    /* Header */
    .topbar{ background:#f8fafc; border-bottom:1px solid var(--border) }
    .topbar .wrap{
      max-width:1100px; margin:0 auto; padding:10px 16px;
      display:flex; align-items:center; justify-content:space-between; min-height:var(--nav-h);
    }
    .brand{ display:flex; align-items:center; gap:10px }
    .brand img{ height:28px; width:auto }
    .brand span{ font-weight:700 }

    /* Nav + hamburger */
    .nav-links{ display:flex; align-items:center; gap:8px }
    .nav-links a{ padding:8px 10px; border-radius:8px; color:#111; font-weight:500 }
    .nav-links a[aria-current="page"]{ font-weight:700; background:#eef7ff; color:#0b77c5 }
    .nav-links a:hover{ background:#eef2f7 }
    .nav-toggle{
      display:none; border:0; background:transparent; width:40px; height:40px; color:#111 !important;
      -webkit-appearance:none; appearance:none; padding:0; margin:0;
    }
    .nav-toggle svg{ width:28px; height:28px; display:block }
    @media (max-width:768px){
      .nav-toggle{ display:inline-flex !important; align-items:center; justify-content:center }
      .nav-links{
        position:fixed; left:0; right:0; top:var(--nav-h);
        background:var(--card); border-top:1px solid var(--border);
        flex-direction:column; padding:12px 16px; display:none; pointer-events:none
      }
      .nav-links.open{ display:flex; pointer-events:auto }
    }

    /* Hero + layout */
    .hero{ max-width:1100px; margin:16px auto 0; padding:0 16px }
    .hero-card{
      background:var(--card); border:1px solid var(--border); border-radius:14px;
      padding:18px; display:flex; justify-content:space-between; gap:16px; align-items:center;
    }
    .hero h1{ margin:0 0 4px; font-size:20px }
    .hero p{ margin:0; color:var(--muted) }

    .grid{
      max-width:1100px; margin:14px auto; padding:0 16px;
      display:grid; grid-template-columns:1.25fr .75fr; gap:18px;
    }
    @media (max-width:980px){ .grid{ grid-template-columns:1fr } }

    .card{ background:var(--card); border:1px solid var(--border); border-radius:14px; padding:16px }
    .section-title{ font-weight:600; margin:10px 0 8px }

    /* Inputs */
    select, input[type="text"], input[type="tel"], input[type="email"]{
      width:100%; height:44px; border:1px solid var(--border); border-radius:10px; padding:10px 12px; font:inherit
    }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
    @media (max-width:720px){ .row{ grid-template-columns:1fr } }
    .muted{ color:var(--muted) }
    .actions{ margin-top:12px; display:flex; align-items:center; gap:12px; flex-wrap:wrap }
    .btn{ display:inline-flex; align-items:center; gap:8px; border:1px solid var(--border); background:#fff; border-radius:999px; padding:10px 14px; font-weight:600; cursor:pointer }
    .btn.primary{ background:var(--accent); border-color:var(--accent); color:#fff }
    .btn.small{ padding:8px 12px; font-weight:600 }
    .btn.rm{ color:#ef4444; border-color:#ef4444 }

    /* Accordion */
    .acc{ border:1px solid var(--border); border-radius:12px; margin-top:12px; background:#fff; overflow:hidden }
    .acc-head{
      width:100%; border:0; background:#fff; padding:12px 14px; font-weight:700; text-align:left;
      border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; cursor:pointer
    }
    .acc-head[aria-expanded="true"]{ background:#f9fbff }
    .acc-panel{ padding:12px 14px; display:none }
    .acc-panel.open{ display:block }

    /* Sub-sections inside a student accordion */
    .sub{ border:1px solid var(--border); border-radius:10px; padding:12px; margin-top:10px; background:#fff }
    .sub h4{ margin:0 0 8px; font-size:14px }

    /* Package cards (card-style radios) */
    .pkg-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px }
    @media (max-width:840px){ .pkg-grid{ grid-template-columns:1fr } }
    .pkg-card{
      border:2px solid #e5e7eb; border-radius:12px; padding:12px;
      cursor:pointer; display:flex; flex-direction:column; gap:8px; min-height:120px; position:relative;
    }
    .pkg-card:hover{ border-color:#d1d5db }
    .pkg-card.selected{ border-color:#3b82f6; background:#f5f9ff; box-shadow:0 0 0 3px rgba(59,130,246,.15) inset }
    .pkg-top{ display:flex; align-items:center; justify-content:space-between; gap:8px }
    .pkg-top span{ font-weight:700 }
    .pkg-top strong{ font-weight:800 }
    .pkg-details{ margin:0; padding-left:18px; color:#374151; font-size:14px }

    /* Add-ons list */
    .addon{ display:flex; align-items:center; gap:10px; padding:8px; border:1px solid var(--border); border-radius:10px; margin-bottom:8px; background:#fff }
    .addon input{ width:18px; height:18px }
    fieldset:disabled{ opacity:.6 }

    /* Summary */
    #summaryCard{ overflow-x:auto }
    table{ width:100%; border-collapse:collapse; table-layout:fixed }
    th,td{ padding:8px; border-bottom:1px solid var(--border); text-align:left; vertical-align:top; word-break:break-word }
    th{ color:var(--muted); font-size:13px }
    .total-row td{ font-weight:700 }
    .kv{ display:grid; grid-template-columns:140px 1fr; row-gap:6px; column-gap:8px; margin-top:10px }
    .kv .k{ color:var(--muted) }

    .pill{ background:#eef2f7; border-radius:999px; padding:2px 8px; font-size:12px; color:#374151 }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="topbar">
    <div class="wrap">
      <a class="brand" href="index.html">
        <img src="2020Logo_black.png" alt="Scott Ymker logo">
        <span>Scott Ymker Photography</span>
      </a>

      <button class="nav-toggle" aria-label="Open menu" aria-controls="site-nav" aria-expanded="false">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <nav id="site-nav" class="nav-links" aria-label="Main">
        <a href="index.html">Home</a>
        <a href="order-accordian.html" aria-current="page">Order</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-card">
      <div>
        <h1>Order • Accordion Flow</h1>
        <p>Add one or more students. Choose background, package, and optional add‑ons for each.</p>
      </div>
      <button id="addStudentBtn" class="btn primary">+ Add another student</button>
    </div>
  </section>

  <!-- Main -->
  <main class="grid">
    <form id="orderForm" class="card" novalidate>
      <!-- 1) Parent -->
      <section class="acc" id="acc-parent">
        <button class="acc-head" type="button" aria-expanded="true">
          1) Parent / Guardian
          <span class="muted" id="parentBadge">Required</span>
        </button>
        <div class="acc-panel open">
          <div class="row" style="margin-bottom:10px">
            <input required name="parent_name" placeholder="Parent full name" oninput="renderSummary()">
            <input required type="tel" name="parent_phone" placeholder="Phone" inputmode="tel" autocomplete="tel" oninput="renderSummary()">
          </div>
          <input required type="email" name="parent_email" placeholder="Email" inputmode="email" autocomplete="email" oninput="renderSummary()">
          <div class="actions">
            <button type="button" class="btn primary" id="toStudents">Save & Continue</button>
          </div>
        </div>
      </section>

      <!-- 2) Students container (dynamic) -->
      <div id="studentsWrap"></div>

      <!-- 3) Review & Checkout -->
      <section class="acc" id="acc-review">
        <button class="acc-head" type="button" aria-expanded="false">
          3) Review & Checkout
          <span class="muted" id="reviewBadge">Waiting</span>
        </button>
        <div class="acc-panel">
          <p class="muted">Confirm everything looks right, then proceed to secure payment.</p>
          <div class="actions">
            <button type="submit" class="btn primary" id="checkoutBtn">Proceed to Checkout</button>
            <span class="muted">You’ll pay securely on Stripe.</span>
          </div>
        </div>
      </section>
    </form>

    <!-- Summary -->
    <aside class="card" id="summaryCard">
      <div class="section-title">Order summary</div>
      <table aria-live="polite">
        <thead>
          <tr><th>Description</th><th>Qty</th><th>Amount</th></tr>
        </thead>
        <tbody id="sumItems"></tbody>
        <tfoot>
          <tr class="total-row"><td>Total</td><td></td><td id="sumTotal">$0.00</td></tr>
        </tfoot>
      </table>
      <div class="kv" style="margin-top:12px">
        <div class="k">Parent</div><div id="kvParent">—</div>
        <div class="k">Email</div><div id="kvEmail">—</div>
        <div class="k">Phone</div><div id="kvPhone">—</div>
        <div class="k">Students</div><div id="kvStudents">0</div>
      </div>
    </aside>
  </main>

  <!-- Nav script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const toggle = document.querySelector('.nav-toggle');
      const nav = document.getElementById('site-nav');
      if (!toggle || !nav) return;
      const close = () => { nav.classList.remove('open'); toggle.setAttribute('aria-expanded','false'); };
      toggle.addEventListener('click', () => {
        const isOpen = !nav.classList.contains('open');
        nav.classList.toggle('open', isOpen);
        toggle.setAttribute('aria-expanded', String(isOpen));
      });
      nav.querySelectorAll('a').forEach(a => a.addEventListener('click', close));
      document.addEventListener('keydown', e => { if (e.key === 'Escape') close(); });
    });
  </script>

  <!-- Accordion logic + multi-student + 10-package support -->
  <script>
    /* ---- Configuration (update prices/details as needed) ---- */
    const PACKAGES = [
      {id:'A',  price:35, title:'Package A',  details:['1 – 8×10','2 – 5×7','8 – Wallets']},
      {id:'B',  price:45, title:'Package B',  details:['1 – 8×10','4 – 5×7','16 – Wallets']},
      {id:'C',  price:60, title:'Package C',  details:['2 – 8×10','4 – 5×7','16 – Wallets']},
      {id:'D',  price:75, title:'Package D',  details:['2 – 8×10','4 – 5×7','1 – 11×14']},
      {id:'E',  price:95, title:'Package E',  details:['Digital + Prints bundle','2 – 8×10, 4 – 5×7, 16 – Wallets']},
      {id:'A1', price:35, title:'Package A1', details:['Alt of A — update text']},
      {id:'B1', price:45, title:'Package B1', details:['Alt of B — update text']},
      {id:'C1', price:60, title:'Package C1', details:['Alt of C — update text']},
      {id:'D1', price:75, title:'Package D1', details:['Alt of D — update text']},
      {id:'E1', price:95, title:'Package E1', details:['Alt of E — update text']}
    ];
    const ADDONS = [
      {id:'F', name:'Retouching', price:10},
      {id:'G', name:'Extra 8×10', price:12},
      {id:'H', name:'Extra 5×7', price:8},
      {id:'I', name:'Extra Wallets', price:6},
      {id:'J', name:'Digital Download', price:25},
      {id:'K', name:'16×20 Poster', price:30},
      {id:'L', name:'Keychains', price:10},
      {id:'M', name:'Magnets', price:10},
      {id:'N', name:'Buttons', price:8},
    ];

    /* ---- App state ---- */
    const state = {
      parent: { name:"", phone:"", email:"" },
      students: []   // array of {id, info:{...}, background, package, addons:[]}
    };

    const maxStudents = 10;

    /* ---- Helpers ---- */
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function openAcc(id){
      document.querySelectorAll('.acc').forEach(sec=>{
        const head = sec.querySelector('.acc-head');
        const panel = sec.querySelector('.acc-panel');
        const open = sec.id === id;
        head.setAttribute('aria-expanded', open);
        panel.classList.toggle('open', open);
      });
    }

    function createPackageGrid(studentId){
      // Builds the package cards grid for a given student section
      const grid = document.createElement('div');
      grid.className = 'pkg-grid';
      PACKAGES.forEach(p=>{
        const label = document.createElement('label');
        label.className = 'pkg-card';
        label.tabIndex = 0;
        label.innerHTML = `
          <input class="sr-only" type="radio" name="package-${studentId}" value="${p.id}" data-price="${p.price}"
                 style="position:absolute;opacity:0;pointer-events:none">
          <div class="pkg-top"><span>${p.title}</span><strong>$${p.price}</strong></div>
          <ul class="pkg-details">${p.details.map(d=>`<li>${d}</li>`).join('')}</ul>
        `;
        grid.appendChild(label);
      });
      return grid;
    }

    function createAddonsList(studentId){
      const fs = document.createElement('fieldset');
      fs.id = `addons-${studentId}`;
      fs.disabled = true;
      ADDONS.forEach(a=>{
        const lab = document.createElement('label');
        lab.className = 'addon';
        lab.innerHTML = `<input type="checkbox" value="${a.id}" data-price="${a.price}"> ${a.name} (+$${a.price})`;
        fs.appendChild(lab);
      });
      return fs;
    }

    function studentTemplate(idx){
      const id = `s${idx}`;
      return `
        <section class="acc" id="acc-${id}">
          <button class="acc-head" type="button" aria-expanded="${idx===1?'true':'false'}">
            2) Student ${idx}
            <span class="pill" id="badge-${id}">Not started</span>
          </button>
          <div class="acc-panel ${idx===1?'open':''}">
            <div class="sub">
              <h4>Student Info</h4>
              <div class="row">
                <input required name="first-${id}" placeholder="First name">
                <input required name="last-${id}" placeholder="Last name">
              </div>
              <div class="row">
                <input required name="teacher-${id}" placeholder="Teacher">
                <input required name="grade-${id}" placeholder="Grade">
              </div>
              <input required name="school-${id}" placeholder="School" style="margin-top:10px">
            </div>

            <div class="sub">
              <h4>Background & Package</h4>
              <label class="muted" for="bg-${id}">Background</label>
              <select id="bg-${id}" name="background-${id}" style="margin:6px 0 12px">
                <option value="F1" selected>F1 (default)</option>
                <option value="F2">F2</option><option value="F3">F3</option>
                <option value="F4">F4</option><option value="F5">F5</option><option value="F6">F6</option>
              </select>
              <div id="pkgGrid-${id}"></div>
            </div>

            <div class="sub">
              <h4>Add‑ons (optional)</h4>
              <div id="addonsWrap-${id}"></div>
            </div>

            <div class="actions">
              <button type="button" class="btn small rm" data-remove="${id}">Remove student</button>
              <button type="button" class="btn primary" data-ready="${id}">Save Student</button>
            </div>
          </div>
        </section>
      `;
    }

    function mountStudent(idx){
      const wrap = document.getElementById('studentsWrap');
      wrap.insertAdjacentHTML('beforeend', studentTemplate(idx));
      const id = `s${idx}`;

      // init state
      state.students.push({ id, info:{}, background:'F1', package:null, addons:[] });

      // package grid + addons
      const gridHost = document.getElementById(`pkgGrid-${id}`);
      gridHost.replaceChildren(createPackageGrid(id));
      const addonsHost = document.getElementById(`addonsWrap-${id}`);
      addonsHost.replaceChildren(createAddonsList(id));

      // listeners unique to this student
      const section = document.getElementById(`acc-${id}`);

      // package click (event delegation within this section)
      section.addEventListener('click', (e)=>{
        const card = e.target.closest('.pkg-card');
        if(!card) return;
        const input = card.querySelector('input[type=radio]');
        if(!input) return;
        // visual select
        section.querySelectorAll('.pkg-card').forEach(c=>c.classList.remove('selected'));
        card.classList.add('selected');
        input.checked = true;
        // enable addons
        section.querySelector(`#addons-${id}`)?.removeAttribute('disabled');
        // update state
        const stu = state.students.find(s=>s.id===id);
        stu.package = input.value;
        renderSummary();
      });

      // background change
      section.querySelector(`#bg-${id}`).addEventListener('change', (e)=>{
        const stu = state.students.find(s=>s.id===id);
        stu.background = e.target.value;
        renderSummary();
      });

      // addons change
      section.querySelector(`#addons-${id}`).addEventListener('change', (e)=>{
        const stu = state.students.find(s=>s.id===id);
        const checks = Array.from(section.querySelectorAll(`#addons-${id} input:checked`)).map(i=>i.value);
        stu.addons = checks;
        renderSummary();
      });

      // save student button
      section.querySelector(`[data-ready="${id}"]`).addEventListener('click', ()=>{
        const f = document.getElementById('orderForm');
        const need = [`first-${id}`,`last-${id}`,`teacher-${id}`,`grade-${id}`,`school-${id}`];
        for(const n of need){ if(!f.elements[n].reportValidity()) return; }
        const stu = state.students.find(s=>s.id===id);
        stu.info = {
          first: f.elements[`first-${id}`].value.trim(),
          last:  f.elements[`last-${id}`].value.trim(),
          teacher:f.elements[`teacher-${id}`].value.trim(),
          grade: f.elements[`grade-${id}`].value.trim(),
          school:f.elements[`school-${id}`].value.trim()
        };
        document.getElementById(`badge-${id}`).textContent = 'Saved';
        renderSummary();
        openAcc('acc-review');
        document.getElementById('reviewBadge').textContent = 'Ready';
      });

      // remove student
      section.querySelector(`[data-remove="${id}"]`).addEventListener('click', ()=>{
        const idx = state.students.findIndex(s=>s.id===id);
        if(idx>-1){ state.students.splice(idx,1); }
        section.remove();
        renderSummary();
      });

      // accordion head toggle for this section
      section.querySelector('.acc-head').addEventListener('click', ()=>{
        const head = section.querySelector('.acc-head');
        const panel = section.querySelector('.acc-panel');
        const isOpen = head.getAttribute('aria-expanded')==='true';
        head.setAttribute('aria-expanded', String(!isOpen));
        panel.classList.toggle('open', !isOpen);
      });

      renderSummary();
    }

    /* ---- Wire-up global actions ---- */

    // Save Parent → open first student (or create it)
    document.getElementById('toStudents').addEventListener('click', ()=>{
      const f = document.getElementById('orderForm');
      const name  = f.elements['parent_name'];
      const phone = f.elements['parent_phone'];
      const email = f.elements['parent_email'];
      if(!name.reportValidity() || !email.reportValidity()) return;
      state.parent = { name:name.value.trim(), phone:phone.value.trim(), email:email.value.trim() };
      document.getElementById('parentBadge').textContent = 'Saved';
      if(state.students.length===0) mountStudent(1);
      openAcc('acc-s1');
      renderSummary();
    });

    // Add another student
    document.getElementById('addStudentBtn').addEventListener('click', ()=>{
      if(state.students.length>=maxStudents){ alert('Maximum students added.'); return; }
      mountStudent(state.students.length+1);
      openAcc(`acc-s${state.students.length}`);
    });

    // Summary renderer
    function renderSummary(){
      // parent KV
      document.getElementById('kvParent').textContent = state.parent.name || '—';
      document.getElementById('kvEmail').textContent  = state.parent.email || '—';
      document.getElementById('kvPhone').textContent  = state.parent.phone || '—';
      document.getElementById('kvStudents').textContent = String(state.students.length);

      // line items
      const tbody = document.getElementById('sumItems');
      tbody.innerHTML = '';
      let total = 0;

      state.students.forEach((stu, i)=>{
        // package
        if(stu.package){
          const p = PACKAGES.find(x=>x.id===stu.package);
          const price = p ? p.price : 0;
          total += price;
          tbody.insertAdjacentHTML('beforeend',
            `<tr><td>Student ${i+1}: Package ${stu.package} (${stu.info.first||''} ${stu.info.last||''})</td><td>1</td><td>$${price.toFixed(2)}</td></tr>`
          );
        } else {
          tbody.insertAdjacentHTML('beforeend',
            `<tr><td>Student ${i+1}: (no package selected)</td><td></td><td>$0.00</td></tr>`
          );
        }
        // addons
        stu.addons.forEach(id=>{
          const a = ADDONS.find(x=>x.id===id);
          if(!a) return;
          total += a.price;
          tbody.insertAdjacentHTML('beforeend',
            `<tr class="subrow"><td class="sub">Add‑on ${a.id} – ${a.name}</td><td>1</td><td>$${a.price.toFixed(2)}</td></tr>`
          );
        });
      });

      if(state.students.length===0){
        tbody.innerHTML = `<tr><td>No students yet</td><td></td><td>$0.00</td></tr>`;
      }

      document.getElementById('sumTotal').textContent = `$${total.toFixed(2)}`;
    }
    window.renderSummary = renderSummary;

    // Checkout submit
    document.getElementById('orderForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!state.parent.name || !state.parent.email){ openAcc('acc-parent'); return; }
      if(state.students.length===0){ alert('Please add at least one student.'); return; }
      // validate each student has a package
      for(const s of state.students){
        if(!s.package){ alert('Each student must have a package selected.'); return; }
      }
      try{
        const res = await fetch('/api/create-checkout', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({
            parent: state.parent,
            students: state.students,
            meta: { flow:'accordion-multi' }
          })
        });
        const data = await res.json();
        if(data?.url){ location.href = data.url; }
        else { alert('Could not start checkout.'); console.error('Checkout error', data); }
      }catch(err){
        alert('Network error starting checkout.');
        console.error(err);
      }
    });

    // Review accordion head
    document.querySelector('#acc-review .acc-head').addEventListener('click', ()=>{
      const sec = document.getElementById('acc-review');
      const head = sec.querySelector('.acc-head');
      const panel = sec.querySelector('.acc-panel');
      const isOpen = head.getAttribute('aria-expanded')==='true';
      head.setAttribute('aria-expanded', String(!isOpen));
      panel.classList.toggle('open', !isOpen);
    });

    // Parent accordion head
    document.querySelector('#acc-parent .acc-head').addEventListener('click', ()=>{
      const sec = document.getElementById('acc-parent');
      const head = sec.querySelector('.acc-head');
      const panel = sec.querySelector('.acc-panel');
      const isOpen = head.getAttribute('aria-expanded')==='true';
      head.setAttribute('aria-expanded', String(!isOpen));
      panel.classList.toggle('open', !isOpen);
    });

    // Start with one student shown for convenience
    mountStudent(1);
  </script>
</body>
</html>
